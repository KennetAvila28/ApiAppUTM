@page "/Events/Passed"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@inject HttpClient _http
@inject NavigationManager navigation
@inject NotificationService NotificationService

@if (_events == null)
{
    <Spinner />
}
else
{
    <div class="container mt-3">
        <div class="d-flex mb-3">
            <h2 class="mx-auto">Lista de eventos</h2>
        </div>
        <RadzenDataGrid AllowColumnResize="true" AllowFiltering="true" FilterMode="FilterMode.Simple" AllowPaging="true" AllowSorting="true" Count="@_count" Data="_events" PageSize="10" TItem="EventReturn">
            <Columns>
                <RadzenDataGridColumn TItem="EventReturn" Property="Title" Title="Titulo">
                    <Template Context="data">
                        @($"{data.Title}")
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="EventReturn" Property="Author.Nombre" Title="Author">
                    <Template Context="data">
                        @($"{data.Author.Nombre}")
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="EventReturn" Property="StartDate" Title="Fecha de inico">
                    <Template Context="data">
                        @($"{data.StartDate:d}")
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="EventReturn" Property="EndDate" Title="Fecha de terminacion">
                    <Template Context="data">
                        @($"{data.EndDate:d}")
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="EventReturn" Property="IsSuggest" Title="Sugerido">
                    <Template Context="data">
                        <RadzenCheckBox @bind-Value="@data.IsSuggest" TValue="bool" Disabled="true" />
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="EventReturn" Property="IsActivity" Title="Actividad">
                    <Template Context="data">
                        <RadzenCheckBox @bind-Value="@data.IsActivity" TValue="bool" Disabled="true" />
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="EventReturn" Title="Acciones">
                    <Template Context="data">
                        <RadzenButton Text="Editar" ButtonStyle="ButtonStyle.Success" Click=@(() => Published(data.Id)) />
                    </Template>
                </RadzenDataGridColumn>
            </Columns>
        </RadzenDataGrid>
    </div>
}

@code
{
    int _count;
    IEnumerable<EventReturn> _events;

    protected override async Task OnInitializedAsync()
    {
        _events = await GetExtensions.GetAllEventsPassed(_http);
    }
    async Task Published(int id)
    {
        var eventMessage = await _http.PostAsJsonAsync("Event/Published", id);
        NotificationExtensions.ShowNotification(NotificationService, eventMessage.IsSuccessStatusCode ? new NotificationMessage { Severity = NotificationSeverity.Success, Summary = "Evento publicado", Duration = 3000 } : new NotificationMessage { Severity = NotificationSeverity.Error, Summary = "No se pudo publicar el evento", Duration = 3000 });
        _events = await GetExtensions.GetAllEvents(_http);
    }
}